# 游戏更新日志 v2.0

## 📅 更新时间
2024年12月18日

## 🎯 核心改动

### 1. 升级系统调整
- **4级后收益减半**：所有属性升级在4级后，每级加成减半
  - 攻击力：1-4级 +0.5/级，5-10级 +0.25/级
  - 攻击速度：1-4级 -10ms/级，5-10级 -5ms/级
  - 移动速度：1-4级 +24px/s/级，5-10级 +12px/s/级
  - 血量：1-4级 +0.5/级，5-10级 +0.25/级
  - 基地血量：1-4级 +100/级，5-10级 +50/级

### 2. 无人机参数调整

#### 攻击距离
- **从 50px 增加到 80px**
- 提升 60%，让无人机有更远的射程

#### 自动索敌距离
- **从 40px 增加到 120px**
- 提升 200%，大幅增强无人机的感知能力
- **新增追击机制**：发现敌人后会主动追击，直到消灭敌人或超出120px范围

#### 玩家控制优化
- **点击敌方单位**：可直接选中攻击目标
- **目标锁定**：无人机会持续攻击选中的目标，直到：
  - 目标被消灭
  - 玩家点击新的目标
  - 玩家设置新的集结点
- **操作打断**：玩家的任何新操作都会打断当前的自动追击

### 3. 投射物调整

#### 速度降低
- **基础速度**：从 240px/s 降低到 99px/s（无人机速度的1.1倍）
- **升级加成**：从 +45px/s 降低到 +20px/s
- **设计目的**：让战斗更具观赏性，子弹不会瞬间命中

#### 穿透机制
- **可穿透己方单位**：子弹不会击中己方无人机和基地
- **无法穿透敌方单位**：击中第一个敌方目标后消失
- **无法穿透物资**：击中飞船碎片后消失

### 4. Boids算法（群体行为）

#### 新增功能
- **自动避免拥挤**：无人机会自动调整位置，避免重叠
- **智能站位**：多架无人机会自动排列，避免后排被前排阻挡
- **协同攻击**：多架无人机可以同时开火，不会互相干扰

#### 算法参数
- **分离半径**：30px（避免过于靠近）
- **对齐半径**：50px（保持相同方向）
- **聚合半径**：50px（向群体中心移动）
- **权重比例**：分离1.5 : 对齐0.3 : 聚合0.2

#### 应用时机
- 到达集结点后
- 没有明确移动目标时
- 不在追击敌人时

## 📊 参数对照表（1200×800画布）

### 无人机速度
| 等级 | 速度（px/s） | 横穿画布时间 |
|-----|-------------|-------------|
| 0级 | 90 | 13.3秒 |
| 4级 | 186 | 6.5秒 |
| 10级 | 258 | 4.7秒 |

### 投射物速度
| 等级 | 速度（px/s） | 与无人机速度比 |
|-----|-------------|---------------|
| 0级 | 99 | 1.1倍 |
| 4级 | 179 | 0.96倍 |
| 10级 | 219 | 0.85倍 |

### 距离参数
| 参数 | 旧值 | 新值 | 变化 |
|-----|------|------|------|
| 攻击范围 | 50px | 80px | +60% |
| 自动索敌范围 | 40px | 120px | +200% |
| 集结范围 | 30px | 30px | 不变 |

## 🎮 游戏体验改进

### 战术深度
1. **前期优势明显**：1-4级升级收益高，快速提升实力
2. **后期需权衡**：5-10级收益减半，需要更谨慎地分配资源
3. **远程优势**：80px攻击距离让玩家可以风筝敌人
4. **主动追击**：120px索敌范围让无人机更主动

### 操作体验
1. **精确控制**：可以点击选中特定目标
2. **自动战斗**：无人机会自动追击发现的敌人
3. **灵活打断**：随时可以改变无人机的行为
4. **智能站位**：Boids算法让无人机自动排列

### 视觉效果
1. **子弹可见**：降低的子弹速度让战斗更有观赏性
2. **穿透效果**：子弹穿过己方单位，视觉更流畅
3. **群体行为**：无人机群体移动更自然

## 🔧 技术实现

### 升级计算公式
```javascript
calculateUpgradeBonus(level, baseBonus) {
    if (level <= 4) {
        return level * baseBonus;
    } else {
        return 4 * baseBonus + (level - 4) * baseBonus * 0.5;
    }
}
```

### Boids算法核心
- **分离（Separation）**：避免碰撞
- **对齐（Alignment）**：保持队形
- **聚合（Cohesion）**：保持团队

### 碰撞检测优化
- 子弹只检测敌方单位和物资
- 跳过己方单位的碰撞检测
- 提升性能和游戏体验

## 🐛 已知问题
- 无

## 📝 后续计划
- 优化Boids算法的性能
- 添加更多视觉反馈（选中目标的高亮）
- 考虑添加编队功能
