# 无人机战略游戏 - 联机版部署指南

## 🎮 项目概述

这是基于 Express.js + Socket.IO 的实时联机无人机战略游戏，支持多人在线对战。

## 📁 项目结构

```
drone-war-online/
├── client/                 # 前端代码
│   ├── index.html         # 联机游戏主页面
│   ├── network.js         # 网络通信层
│   └── assets/           # 游戏资源
├── server/                # 后端代码
│   ├── app.js            # Express应用入口
│   ├── gameServer.js     # 游戏服务器逻辑
│   ├── roomManager.js    # 房间管理
│   └── gameLogic.js      # 服务端游戏逻辑
├── package.json          # 项目依赖
├── Dockerfile           # 微信云托管部署配置
└── healthcheck.js       # 健康检查脚本
```

## 🚀 本地开发

### 1. 安装依赖
```bash
npm install
```

### 2. 启动开发服务器
```bash
npm run dev
```

### 3. 访问游戏
打开浏览器访问: `http://localhost:3000`

## ☁️ 微信云托管部署

### 1. 准备工作
- 注册微信开发者账号
- 开通微信云托管服务
- 安装微信开发者工具

### 2. 部署步骤

#### 方式一：通过微信开发者工具
1. 打开微信开发者工具
2. 选择"云托管"项目类型
3. 上传项目代码
4. 配置容器服务

#### 方式二：通过命令行
```bash
# 构建Docker镜像
docker build -t drone-war-online .

# 推送到微信云托管
# (需要先配置微信云托管的镜像仓库)
```

### 3. 环境配置

在微信云托管控制台设置环境变量：
- `PORT`: 3000 (默认端口)
- `NODE_ENV`: production

### 4. 域名配置
- 在微信云托管控制台绑定自定义域名
- 配置HTTPS证书（推荐）

## 🎯 游戏功能

### 核心功能
- ✅ 实时多人对战
- ✅ 房间系统（创建/加入房间）
- ✅ 玩家匹配
- ✅ 游戏状态同步
- ✅ 断线重连

### 游戏模式
- **1v1对战**: 两名玩家对战
- **2v2团队**: 四名玩家分队对战
- **混战模式**: 多人自由对战

### 技术特性
- **WebSocket通信**: 基于Socket.IO的实时通信
- **客户端预测**: 减少网络延迟影响
- **服务端验证**: 防止作弊和数据篡改
- **房间管理**: 自动房间清理和玩家管理

## 🔧 配置说明

### 服务器配置
```javascript
// server/app.js
const PORT = process.env.PORT || 3000;
```

### 客户端配置
```javascript
// client/network.js
const serverUrl = 'https://your-domain.com'; // 生产环境域名
```

## 📊 监控和日志

### 健康检查
- 端点: `/api/status`
- 返回服务器状态、在线玩家数、房间数等信息

### 日志记录
- 玩家连接/断开日志
- 房间创建/销毁日志
- 游戏开始/结束日志
- 错误和异常日志

## 🛠️ 开发指南

### 添加新功能
1. 在 `server/gameLogic.js` 中添加服务端逻辑
2. 在 `client/network.js` 中添加客户端通信
3. 在 `game.js` 中集成新功能

### 调试技巧
- 使用浏览器开发者工具查看WebSocket通信
- 检查服务器日志定位问题
- 使用 `npm run dev` 启用热重载

## 🔒 安全考虑

### 数据验证
- 所有客户端输入都在服务端验证
- 游戏状态由服务端权威控制
- 防止速度作弊和位置篡改

### 网络安全
- 使用HTTPS加密通信
- 限制连接频率防止DDoS
- 输入数据清理和验证

## 📈 性能优化

### 服务端优化
- 游戏状态增量更新
- 对象池减少GC压力
- 定时清理无效房间

### 客户端优化
- 客户端预测减少延迟感
- 批量渲染相同类型对象
- 降低非关键更新频率

## 🐛 常见问题

### Q: 连接服务器失败
A: 检查网络连接和服务器地址配置

### Q: 游戏卡顿
A: 检查网络延迟，考虑使用CDN加速

### Q: 房间无法创建
A: 检查服务器资源使用情况

## 📞 技术支持

如有问题，请检查：
1. 服务器日志
2. 浏览器控制台错误
3. 网络连接状态
4. 微信云托管服务状态

## 🎉 部署完成

部署成功后，玩家可以通过以下方式体验游戏：
1. 访问游戏网址
2. 输入昵称和选择颜色
3. 连接服务器
4. 创建或加入房间
5. 等待其他玩家加入
6. 开始联机对战！

祝你游戏愉快！🚀