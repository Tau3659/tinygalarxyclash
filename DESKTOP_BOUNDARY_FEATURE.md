# 安全边界功能说明（桌面端 + 移动端）

## 功能概述

为桌面端和移动端浏览器添加了安全边界限制功能，防止无人机进入UI面板区域，确保游戏界面的清晰性和操作的准确性。

## 功能特性

### 1. 无人机移动限制
- **桌面端边界检查**：无人机无法移动到左侧UI面板区域（蓝色虚线左侧）
- **移动端边界检查**：无人机无法移动到顶部UI面板区域（蓝色虚线上方）
- **实时限制**：无人机在移动过程中会被安全边界阻挡
- **平滑停止**：无人机到达边界后会平滑停止，不会产生抖动

### 2. 鼠标/触摸点击目标限制
- **桌面端智能重定向**：点击左侧UI面板区域时，目标位置会自动调整到安全边界
- **移动端智能重定向**：点击顶部UI面板区域时，目标位置会自动调整到安全边界
- **即时响应**：点击后无人机立即向安全边界移动
- **控制台提示**：在开发者控制台显示边界限制信息

### 3. 无人机生成位置限制
- **安全生成**：新生成的无人机不会出现在UI面板区域
- **位置验证**：生成位置会经过安全边界检查
- **自动调整**：如果生成位置不合法，会自动寻找合适的位置

### 4. AI无人机边界限制
- **AI遵守边界**：敌方AI无人机也遵守相同的安全边界
- **集结点调整**：AI设置集结点时会自动调整到安全区域
- **智能避让**：AI战术决策会考虑安全边界限制

### 5. 可视化指示器
- **蓝色虚线**：清晰标示安全边界位置，与UI面板颜色搭配
- **优雅样式**：8px-4px间隔的虚线样式，半透明蓝色
- **动态显示**：根据设备类型显示不同方向的边界线
- **简洁设计**：移除了红色注释文字，界面更简洁

## 技术实现

### 1. 边界检测逻辑
```javascript
// 设备类型检测
const isMobile = canvas.width <= 768;
if (uiSafeArea) {
    if (isMobile) {
        // 移动端：检查顶部边界
        if (y < uiSafeArea.top) return false;
    } else {
        // 桌面端：检查左侧边界
        if (x < uiSafeArea.left) return false;
    }
}
```

### 2. 点击目标重定向
```javascript
if (isMobile) {
    // 移动端：重定向Y坐标
    if (y < this.uiSafeArea.top) {
        y = this.uiSafeArea.top;
    }
} else {
    // 桌面端：重定向X坐标
    if (x < this.uiSafeArea.left) {
        x = this.uiSafeArea.left;
    }
}
```

### 3. 安全边界函数
```javascript
ensureRallyPointInSafeArea(x, y) {
    const isMobile = this.canvas.width <= 768;
    if (isMobile && y < this.uiSafeArea.top) {
        y = this.uiSafeArea.top + 20; // 缓冲区
    } else if (!isMobile && x < this.uiSafeArea.left) {
        x = this.uiSafeArea.left + 20; // 缓冲区
    }
    return { x, y };
}
```

### 4. 可视化渲染
```javascript
// 蓝色半透明边界线
ctx.strokeStyle = 'rgba(100, 200, 255, 0.6)';
ctx.setLineDash([8, 4]); // 优雅虚线

if (isMobile) {
    // 移动端：水平线
    ctx.moveTo(0, uiSafeArea.top);
    ctx.lineTo(canvas.width, uiSafeArea.top);
} else {
    // 桌面端：垂直线
    ctx.moveTo(uiSafeArea.left, 0);
    ctx.lineTo(uiSafeArea.left, canvas.height);
}
```

## 适配性设计

### 桌面端（屏幕宽度 > 768px）
- ✅ 启用左侧安全边界功能
- ✅ 显示左侧垂直蓝色虚线
- ✅ 限制无人机进入左侧UI区域
- ✅ 重定向鼠标点击目标

### 移动端（屏幕宽度 ≤ 768px）
- ✅ 启用顶部安全边界功能
- ✅ 显示顶部水平蓝色虚线
- ✅ 限制无人机进入顶部UI区域
- ✅ 重定向触摸点击目标

### 响应式适配
- **动态检测**：根据窗口宽度实时判断设备类型
- **无缝切换**：窗口大小变化时自动切换边界类型
- **性能优化**：使用相同的检测逻辑，减少代码重复

## 样式改进

### 视觉设计
1. **颜色搭配**：从红色改为蓝色半透明，与UI面板颜色协调
2. **虚线样式**：8px-4px间隔，更优雅的视觉效果
3. **简洁界面**：移除红色注释文字，减少视觉干扰
4. **透明度**：rgba(100, 200, 255, 0.6)，既清晰又不突兀

### 用户体验
1. **视觉提示**：蓝色虚线清晰标示禁入区域
2. **平滑交互**：无人机移动到边界时平滑停止
3. **智能重定向**：点击UI区域时自动调整到合理位置
4. **统一体验**：桌面端和移动端使用一致的交互逻辑

## 测试验证

### 桌面端测试步骤
1. 确保浏览器窗口宽度 > 768px
2. 观察左侧是否显示蓝色虚线边界
3. 点击蓝色虚线左侧的UI面板区域
4. 验证无人机是否移动到边界线停止
5. 验证AI无人机也无法越过边界

### 移动端测试步骤
1. 将浏览器窗口宽度调整到 ≤ 768px 或使用手机
2. 观察顶部是否显示蓝色虚线边界
3. 点击蓝色虚线上方的UI面板区域
4. 验证无人机是否移动到边界线停止
5. 验证AI无人机也无法进入顶部区域

### 响应式测试
1. 在桌面端和移动端之间切换窗口大小
2. 验证边界线方向正确切换（垂直↔水平）
3. 验证边界检测逻辑正确切换
4. 验证点击重定向逻辑正确切换

### 预期结果
- ✅ 桌面端显示左侧蓝色边界线
- ✅ 移动端显示顶部蓝色边界线
- ✅ 无人机无法进入对应的UI区域
- ✅ 点击UI区域时无人机移动到边界停止
- ✅ AI无人机也遵守相同边界
- ✅ 窗口大小变化时功能正确切换

## 兼容性

### 浏览器支持
- ✅ Chrome 80+
- ✅ Firefox 75+
- ✅ Safari 13+
- ✅ Edge 80+

### 设备支持
- ✅ 桌面端：Windows、macOS、Linux（左侧边界）
- ✅ 移动端：iOS、Android（顶部边界）
- ✅ 平板设备：根据屏幕宽度自动判断

## 性能影响

### 计算开销
- **边界检查**：每次移动增加1-2次条件判断（O(1)）
- **渲染开销**：每帧增加边界线绘制
- **内存占用**：无额外内存占用

### 优化措施
- **统一逻辑**：桌面端和移动端使用相同的检测框架
- **缓存计算**：uiSafeArea值在窗口大小变化时才重新计算
- **渲染优化**：使用简单的线条绘制，性能影响微乎其微

## 未来扩展

### 可能的增强功能
1. **自定义边界**：允许用户调整安全边界大小
2. **边界动画**：添加边界线的动态效果
3. **声音反馈**：无人机碰到边界时播放音效
4. **边界穿透**：特殊情况下允许临时穿越边界
5. **多层边界**：不同类型单位使用不同的边界规则

### 代码维护
- **模块化设计**：边界检查逻辑集中在专门的方法中
- **配置化**：边界参数可通过配置文件调整
- **测试覆盖**：包含完整的单元测试和集成测试
- **文档完善**：详细的API文档和使用说明